<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header class="d-flex flex-wrap align-items-center sticky-top justify-content-center justify-content-md-between mb-4 border-bottom bg-white">
        <div class="col-md-3 mb-2 mb-md-0">
            <a href="/" class="d-inline-flex link-body-emphasis text-decoration-none ms-5 mt-1">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 48 48">
                    <path fill="#37474f" d="M19.78,31.91c0.5-0.99,0.11-2.19-0.87-2.69l-3.09-1.57C16.45,27.24,17.2,27,18,27 c2.21,0,4,1.79,4,4c0,2.21-1.79,4-4,4c-2.14,0-3.88-1.68-3.99-3.79l3.08,1.57C17.38,32.93,17.69,33,18,33 C18.73,33,19.43,32.6,19.78,31.91z"></path><path fill="#37474f" d="M29,13c-3.31,0-6,2.69-6,6s2.69,6,6,6s6-2.69,6-6S32.31,13,29,13z M29,23c-2.21,0-4-1.79-4-4 s1.79-4,4-4s4,1.79,4,4S31.21,23,29,23z"></path><path fill="#37474f" d="M44,24c0,11.05-8.95,20-20,20C13.69,44,5.21,36.21,4.12,26.19l7.94,4.03 C12.02,30.48,12,30.74,12,31c0,3.31,2.69,6,6,6s6-2.69,6-6c0-0.17-0.01-0.33-0.03-0.5c0.43-0.26,0.88-0.54,1.36-0.83 c1.39-0.83,2.92-1.77,4.15-2.69C33.67,26.73,37,23.26,37,19c0-4.42-3.58-8-8-8s-8,3.58-8,8c0,0.09,0.01,0.18,0.01,0.28 c-0.82,1.14-1.63,2.48-2.36,3.7c-0.47,0.77-0.91,1.5-1.28,2.05c-1.36,0.14-2.57,0.74-3.51,1.63l-9.73-4.95 C5.27,11.74,13.73,4,24,4C35.05,4,44,12.95,44,24z"></path>
                    </svg>
            </a>
        </div>

        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
            <li><h3><a href="" class="nav-link px-2">Bienvenido a tu barra de tareas</a></h3></li>
        </ul>

        <div class="col-md-3 text-end">
            
            <a href="/logout" class="btn btn-outline-danger me-5">
                Cerrar sesion
            </a>
        </div>
    </header>
    <div class="w-100 d-flex flex-column container mt-5" id="tareas">

    </div>

    <div class="container text-center mt-4 pb-4 sticky-bottom bg-white pt-2">
        <div class="row">
            <div class=" col-9">
                <input type="text" class="form-control border-primary"  id="nuevaTarea" placeholder="Inserte su tarea...">
            </div>

            <div class="col-3">
                <button id="botonNuevaTarea" class="btn btn-primary w-100">Enviar</button>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/allTareasUser')
        .then(response => response.json())
        .then(tareas => {
            for(let i = 0; i < tareas.length; i++){
                tarea = tareas[i];

              /*  var divTarea = document.createElement('div');
                divTarea.classList.add("p-3", "px-5", "bg-success", "my-3", "d-flex", "flex-row","justify-content-between",)

                var trash = document.createElement('i');
                var button = document.createElement('button');
                button.classList.add("btn", "btn-outline-danger")
                trash.classList.add("fa-solid","fa-trash",);
                button.appendChild(trash)

                var h2 = document.createElement('h2');
                h2.textContent = tarea.texto;


                divTarea.appendChild(h2);
                divTarea.appendChild(button);
*/
                var capaTarea = document.createElement('div');
                var capaBodyTarea = document.createElement('div');
                var capaTexto = document.createElement('div');
                var iconos = document.createElement('div');

                //Iconos
                var papelera = document.createElement('i');
                var button = document.createElement('button');
                button.classList.add('btn','btn-outline-danger');

                //Encabezado del texto
                var h5 = document.createElement('h5');

                //Añadir las clases a cada etiqueta contenedora
                capaTarea.classList.add('tarea', 'card', 'w-100', 'mb-4', 'border-0');
                capaBodyTarea.classList.add('card-body', 'row', 'rounded-2', 'px-0', 'border', 'border-2');
                capaTexto.classList.add('texto', 'col-11', 'pt-2');
                iconos.classList.add('col-1');  

                //Añadir las clases a cada etiqueta de iconos
                papelera.classList.add('fa-solid', 'fa-trash', 'papelera',);  
                h5.classList.add('d-inline', 'realizado', 'encabezadoNoTick');                                                                   //nuevom azul que añado con manejadorFoto

                //Añadir el texto de la tarea al div de texto
                h5.innerHTML=tarea.texto;

                //Añadimos los idTarea a los iconos
                button.setAttribute("data-idTarea",tarea.id);
                button.addEventListener('click', manejadorBorrar);
                button.appendChild(papelera);

                capaTexto.appendChild(h5);
                
                iconos.appendChild(button);
                

                capaTarea.appendChild(capaBodyTarea);
                capaBodyTarea.appendChild(capaTexto);
                capaBodyTarea.appendChild(iconos);

                document.getElementById('tareas').appendChild(capaTarea);

            }
        })
        .catch(error => console.error('Error:', error));
    });

    function manejadorBorrar(){
        //this referencia al elementos del DOM sobre el que hemos hecho click
        let idTarea = this.getAttribute('data-idTarea');
        const configuracion = {
            method: 'GET',
            headers: {
            'Content-Type': 'application/json'
            },
        };
        
        //Llamamos al script del servidor que borra la tarea pasándole el idTarea como parámetro
        fetch('/api/borrar/'+idTarea, configuracion)
        .then(datos => datos.json())
        .then(respuesta =>{
            console.log(respuesta);
            if(respuesta.respuesta=='ok'){
                this.parentElement.parentElement.parentElement.remove(); //igualico cuando hagas el borrar
                alert("Se ha borrado correctamente")
            }

            if(respuesta.respuesta=='no'){
                alert("No se pudo borrar la tarea")
            }
        })
        .finally(function(){
            
        });
    }
    
    
    document.getElementById('botonNuevaTarea').addEventListener('click', () => {
        const textoTarea = document.getElementById('nuevaTarea').value;

        const datos = {
            texto: textoTarea,
        };

        const configuracion = {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify(datos)
        };

        //Llamamos al script de la api que borra la tarea pasándole el idTarea como parámetro
        fetch('/api/insertar', configuracion)
        .then(datos => datos.json())
        .then(tarea =>{
            if(tarea.texto==""){
                alert('No se puede insertar la tarea');
                return;
            }
            var capaTarea = document.createElement('div');
                var capaBodyTarea = document.createElement('div');
                var capaTexto = document.createElement('div');
                var iconos = document.createElement('div');

                //Iconos
                var papelera = document.createElement('i');
                var button = document.createElement('button');
                button.classList.add('btn','btn-outline-danger');

                //Encabezado del texto
                var h5 = document.createElement('h5');

                //Añadir las clases a cada etiqueta contenedora
                capaTarea.classList.add('tarea', 'card', 'w-100', 'mb-4', 'border-0');
                capaBodyTarea.classList.add('card-body', 'row', 'rounded-2', 'px-0', 'border', 'border-2');
                capaTexto.classList.add('texto', 'col-11', 'pt-2');
                iconos.classList.add('col-1');  

                //Añadir las clases a cada etiqueta de iconos
                papelera.classList.add('fa-solid', 'fa-trash', 'papelera',);  
                h5.classList.add('d-inline', 'realizado', 'encabezadoNoTick');                                                                   //nuevom azul que añado con manejadorFoto

                //Añadir el texto de la tarea al div de texto
                h5.innerHTML=tarea.texto;

                //Añadimos los idTarea a los iconos
                button.setAttribute("data-idTarea",tarea.id);
                button.addEventListener('click', manejadorBorrar);
                button.appendChild(papelera);

                capaTexto.appendChild(h5);
                
                iconos.appendChild(button);
                

                capaTarea.appendChild(capaBodyTarea);
                capaBodyTarea.appendChild(capaTexto);
                capaBodyTarea.appendChild(iconos);

                document.getElementById('tareas').appendChild(capaTarea);
        })
        .finally(function(){
            
        });
    });
    

</script>
</body>

</html>

